"use strict";var _asyncWx=require("../../utils/asyncWx.js");Page({data:{address:{},cart:[],allChecked:!1,totalPrice:0,totalNum:0},onShow:function(){var e=wx.getStorageSync("address"),t=wx.getStorageSync("cart")||[];this.setData({address:e}),this.setCart(t)},handleChooseAddress:function(){var t,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap((0,_asyncWx.getSetting)());case 3:if(t=e.sent,!1===t.authSetting["scope.address"])return e.next=8,regeneratorRuntime.awrap((0,_asyncWx.openSetting)());e.next=8;break;case 8:return e.next=10,regeneratorRuntime.awrap((0,_asyncWx.chooseAddress)());case 10:(a=e.sent).all=a.provinceName+a.cityName+a.countyName+a.detailInfo,wx.setStorageSync("address",a),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0);case 18:case"end":return e.stop()}},null,null,[[0,15]])},handeItemChange:function(e){var t=e.currentTarget.dataset.id,a=this.data.cart,r=a.findIndex(function(e){return e.goods_id===t});a[r].checked=!a[r].checked,this.setCart(a)},setCart:function(e){var t=!0,a=0,r=0;e.forEach(function(e){e.checked?(a+=e.num*e.goods_price,r+=e.num):t=!1}),t=0!=e.length&&t,this.setData({cart:e,totalPrice:a,totalNum:r,allChecked:t}),wx.setStorageSync("cart",e)},handleItemAllCheck:function(){var e=this.data,t=e.cart,a=e.allChecked;a=!a,t.forEach(function(e){return e.checked=a}),this.setCart(t)},handleItemNumEdit:function(t){var a,r,n,s,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.currentTarget.dataset,r=a.operation,n=a.id,s=this.data.cart,c=s.findIndex(function(e){return e.goods_id===n}),1===s[c].num&&-1===r)return e.next=6,regeneratorRuntime.awrap((0,_asyncWx.showModal)({content:"您是否要删除?"}));e.next=10;break;case 6:e.sent.confirm&&(s.splice(c,1),this.setCart(s)),e.next=12;break;case 10:s[c].num+=r,this.setCart(s);case 12:case"end":return e.stop()}},null,this)},handlePay:function(){var t,a,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.data,a=t.address,r=t.totalNum,a.userName){e.next=5;break}return e.next=4,regeneratorRuntime.awrap((0,_asyncWx.showToast)({title:"您还没有选择收货地址"}));case 4:return e.abrupt("return");case 5:if(0===r)return e.next=8,regeneratorRuntime.awrap((0,_asyncWx.showToast)({title:"您还没有选购商品"}));e.next=9;break;case 8:return e.abrupt("return");case 9:wx.navigateTo({url:"/pages/pay/index"});case 10:case"end":return e.stop()}},null,this)}});